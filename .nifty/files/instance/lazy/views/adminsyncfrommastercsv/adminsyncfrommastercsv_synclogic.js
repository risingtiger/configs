const TestRow=(csvrow,stores,machines,chips)=>new Promise(async(res,_rej)=>{const store=stores.find((s)=>s.logistics_nationalwaterid===csvrow.nwsid);if(!store){res({msg:`No store found with National Water ID ${csvrow.nwsid}`,action:'addstore'});return}const linkedMachines=machines.filter((m)=>m.store_id===store.store_id);const linkedChips=linkedMachines.map((machine)=>chips.find((chip)=>chip.chip_id===machine.chip_id));const logisticsMachineIds=linkedMachines.map((machine)=>machine.logistics_machineid).sort();const logisticsChipIds=linkedChips.map((chip)=>chip.logistics_chipid).sort();const normalizedLogisticsChipIds=logisticsChipIds.filter((id)=>id!=='0000000');const normalizedCsvChipIds=csvrow.chipids.filter((id)=>id!=='0000000');if(normalizedCsvChipIds.length>normalizedLogisticsChipIds.length){res({msg:`nwid: ${csvrow.nwsid}. csv chipids ${csvrow.chipids.join(',')} include more entries than logistics chips ${logisticsChipIds.join(',')}`,action:null});return}if(normalizedCsvChipIds.length<normalizedLogisticsChipIds.length){res({msg:`nwid: ${csvrow.nwsid}. logistics chipids ${logisticsChipIds.join(',')} outnumber csv chipids ${csvrow.chipids.join(',')}. add chipid to csv file.`,action:null});return}const sortedLogisticsChipIds=[...normalizedLogisticsChipIds].sort();const sortedCsvChipIds=[...normalizedCsvChipIds].sort();for(let index=0;index<sortedLogisticsChipIds.length;index+=1){if(sortedLogisticsChipIds[index]!==sortedCsvChipIds[index]){res({msg:`nwid: ${csvrow.nwsid}. logistics_chipids ${sortedLogisticsChipIds.join(',')} !== csvrow.chipids ${sortedCsvChipIds.join(',')}`,action:null});return}}const normalizedLogisticsMachineIds=logisticsMachineIds.filter((id)=>id!=='0000000');const normalizedCsvMachineIds=csvrow.machineids.filter((id)=>id!=='0000000');if(normalizedLogisticsMachineIds.length===normalizedCsvMachineIds.length){const sortedLogisticsMachineIds=[...normalizedLogisticsMachineIds].sort();const sortedCsvMachineIds=[...normalizedCsvMachineIds].sort();for(let index=0;index<sortedLogisticsMachineIds.length;index+=1){if(sortedLogisticsMachineIds[index]!==sortedCsvMachineIds[index]){res({msg:`nwid: ${csvrow.nwsid}. logistics_machineids ${sortedLogisticsMachineIds.join(',')} !== csvrow.machineids ${sortedCsvMachineIds.join(',')}`,action:null});return}}}else if(normalizedCsvMachineIds.length===normalizedCsvChipIds.length){res({msg:`nwid: ${csvrow.nwsid}. chipids length match but logistics_machineids length !== csvrow.machineids length`,action:null});return}if(csvrow.storename!==store.store_description||csvrow.address!==store.address||csvrow.city!==store.city||csvrow.state!==store.state||csvrow.zip!==store.zip){res({msg:`nwid: ${csvrow.nwsid}. address, city, state, zip or store name no match`,action:'updatestore'});return}if(csvrow.storeid!==store.logistics_storeid){res({msg:`nwid: ${csvrow.nwsid}. logistics_storeid: ${store.logistics_storeid} !== csvrow.storeid: ${csvrow.storeid}`,action:'updatestore'});return}res({});return});const SyncLogic={TestRow};export{SyncLogic}
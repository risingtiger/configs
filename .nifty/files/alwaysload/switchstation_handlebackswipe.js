const EDGE_ZONE=20;const SWIPE_VELOCITY_THRESHOLD=0.3;const MIN_SWIPE_DISTANCE=50;class BackSwipeHandler{swipe_state;prepare_view_callback=null;is_native_swipe_callback=null;constructor(){const is_ios=/iPhone|iPad/.test(navigator.userAgent);const is_safari=/Safari/.test(navigator.userAgent);const is_not_chrome=!/Chrome|CriOS/.test(navigator.userAgent);this.swipe_state={is_ios_safari:is_ios&&is_safari&&is_not_chrome,is_native_swipe:false,swipe_start_x:0,swipe_start_time:0,touch_identifier:null};if(this.swipe_state.is_ios_safari){this.init_listeners()}}init_listeners(){window.addEventListener('touchstart',(e)=>{const touch=e.touches[0];if(touch.clientX<EDGE_ZONE){this.swipe_state.swipe_start_x=touch.clientX;this.swipe_state.swipe_start_time=Date.now();this.swipe_state.touch_identifier=touch.identifier;this.swipe_state.is_native_swipe=true;this.prepare_views_for_native_swipe()}},{passive:true});window.addEventListener('touchmove',(e)=>{if(!this.swipe_state.is_native_swipe||this.swipe_state.touch_identifier===null)return;const touch=Array.from(e.touches).find((t)=>t.identifier===this.swipe_state.touch_identifier);if(!touch)return;const delta_x=touch.clientX-this.swipe_state.swipe_start_x;const delta_time=Date.now()-this.swipe_state.swipe_start_time;if(delta_x>MIN_SWIPE_DISTANCE&&delta_time>0){const velocity=delta_x/delta_time;if(velocity>SWIPE_VELOCITY_THRESHOLD){this.prepare_views_for_native_swipe()}}else if(delta_x<-10){this.swipe_state.is_native_swipe=false}},{passive:true});window.addEventListener('touchend',(e)=>{if(this.swipe_state.touch_identifier===null)return;const ended_touch=Array.from(e.changedTouches).find((t)=>t.identifier===this.swipe_state.touch_identifier);if(ended_touch){const delta_x=ended_touch.clientX-this.swipe_state.swipe_start_x;const delta_time=Date.now()-this.swipe_state.swipe_start_time;if(delta_x<MIN_SWIPE_DISTANCE||delta_time>0&&delta_x/delta_time<SWIPE_VELOCITY_THRESHOLD){this.swipe_state.is_native_swipe=false}this.swipe_state.touch_identifier=null}},{passive:true});window.addEventListener('touchcancel',()=>{this.swipe_state.is_native_swipe=false;this.swipe_state.touch_identifier=null},{passive:true})}prepare_views_for_native_swipe(){if(this.prepare_view_callback){this.prepare_view_callback()}}on_prepare_view(callback){this.prepare_view_callback=callback}was_native_swipe(){const was_swipe=this.swipe_state.is_native_swipe;this.swipe_state.is_native_swipe=false;return was_swipe}is_ios_safari(){return this.swipe_state.is_ios_safari}}export const back_swipe_handler=new BackSwipeHandler()